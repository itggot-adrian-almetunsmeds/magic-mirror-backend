const scheme = "<%= @scheme %>";
var uri = scheme + window.document.location.host + "/";
var count = 0

function connectWebsocket() {
    const ws = new WebSocket(uri);
    useWebSocket(ws)
}

function useWebSocket(ws) {
    if (ws && count < 2) {
        ws.onopen = function () {
           count = 0
           console.log('Connected to ws')
        }
        ws.onmessage = function (message) {
            console.log(JSON.parse(message.data))
        }
        ws.onclose = function () {
            console.log('Disconnected from ws')
            count += 1
            setTimeout(connectWebsocket(), 4000)
        }
    } else {
        setTimeout(connectWebsocket(), 15000)
    }
}

connectWebsocket()