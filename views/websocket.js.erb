const scheme = "<%= @scheme %>";
var uri = scheme + window.document.location.host + "/";
var count = 0

function connectWebsocket() {
    const ws = new WebSocket(uri);
    useWebSocket(ws)
}

function useWebSocket(ws) {
    if (ws && count < 2) {
        ws.onopen = function () {
           count = 0
           console.log('Connected to ws')
        }
        // When recieves message, checks message type and sends data to rendering function in main.js
        ws.onmessage = function (message) {
            console.log(JSON.parse(message.data));
            message = JSON.parse(message.data);
            console.log(message["channel"]);
            if (message["channel"] == "weather"){
                console.log("message recieved");
                message = message['message'];
                weather_data = message[0];
                weatherComponent(weather_data);
            }


        }
        ws.onclose = function () {
            console.log('Disconnected from ws')
            count += 1
            setTimeout(connectWebsocket(), 4000)
        }
    } else {
        setTimeout(connectWebsocket(), 15000)
    }
}

connectWebsocket()